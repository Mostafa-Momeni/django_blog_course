{% extends '_base.html' %}
{% load static %}

{% block title %}Post Detail{% endblock title %}

{% load crispy_forms_tags %}

{% block content %}
<section class="blog_area single-post-area section-padding">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 posts-list">
                <!-- محتوای پست -->
                <div class="single-post">
                    <div class="feature-img">
                        {% if post.photo %}
                            <img class="card-img rounded-0" src="{{ post.photo.url }}" alt="{{ post.title }}">
                        {% else %}
                            <img class="card-img rounded-0" src="{% static 'assets/img/blog/placeholder.jpg' %}" alt="No image">
                        {% endif %}
                    </div>
                    <div class="blog_details">
                        <h1>{{ post.title }}</h1>
                        <ul class="blog-info-link">
                            <li><a href="#"><i class="fa fa-clock"></i><time datetime="2020-01-01">{{ post.date }}</time></a></li>
                            <li><a href="#"><i class="fa fa-user"></i> {{ post.author }}</a></li>
                            <li><a href="#"><i class="fa fa-comments"></i> {{ post.comments.count }} Comments</a></li>
                        </ul>
                        <hr>
                        <h3 class="excert">{{ post.excerpt }}</h3>
                        <br>
                        <p>{{ post.body }}</p>
                        <div class="quote-wrapper">
                            <div class="quotes">
                                {{ post.quotes }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navigation-top">
                    <div class="d-sm-flex justify-content-between align-items-center text-center">
                        <!-- لایک‌ها -->
                        <div class="d-flex gap-4 align-items-center ml-2">
                            <!-- لایک -->
                            <a href="#" class="text-decoration-none text-dark like-info">
                                <span class="align-middle"><i class="fa fa-thumbs-up"></i></span> 
                                <span class="like-count">12</span>
                            </a>

                            <!-- دیس لایک -->
                            <a href="#" class="text-decoration-none text-dark like-info ml-2">
                                <span class="align-middle"><i class="fa fa-thumbs-down"></i></span> 
                                <span class="dislike-count">2</span>
                            </a>
                        </div>
                        {% if user.username == post.author.username %}
                            <div class="d-flex gap-4">
                                <!-- Update Button -->
                                <p class="like-info mb-0">
                                    <a href="{% url 'update' post.pk %}" class="text-decoration-none text-dark">
                                        <span class="align-middle"><i class="bi bi-pencil-square"></i></span> Update Post
                                    </a>
                                </p>
                                <!-- Delete Button -->
                                <p class="like-info mb-0">
                                    <a href="{% url 'delete' post.pk %}" class="text-decoration-none text-dark ml-2">
                                        <span class="align-middle"><i class="bi bi-trash"></i></span> Delete Post
                                    </a>
                                </p>
                            </div>
                        {% endif %}
                        <ul class="social-icons">
                            <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#"><i class="fab fa-dribbble"></i></a></li>
                            <li><a href="#"><i class="fab fa-behance"></i></a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- اطلاعات نویسنده -->
                <div class="blog-author">
                    <div class="media align-items-center">
                        <img src="{{ post.author.photo.url }}" alt="">
                        <div class="media-body">
                            <a href="#">
                                <h4>{{ post.author }}</h4>
                            </a>
                            <div class="social-links">
                                <ul class="header-social">    
                                    <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                                    <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                                    <li><a href="#"><i class="fab fa-instagram"></i></a></li>
                                    <li><a href="#"><i class="fab fa-youtube"></i></a></li>
                                </ul>
                            </div>
                            <p>{{ post.author.about }}</p>
                        </div>
                    </div>
                </div>

                <!-- بخش نظرات -->
                <div class="comments-section">
                    <div class="comments-header">
                        <h4>
                            {% if post.comments.count > 0 %}
                                {{ post.comments.count }} نظر
                            {% else %}
                                <p>اولین نفر باشید که نظر می‌دهد</p>
                                <ul class="submenu">
                                    <li><a href="{% url 'login' %}">Login</a></li>
                                    <li><a href="{% url 'signup' %}">Sign Up</a></li>
                                </ul>
                            {% endif %}
                        </h4>
                    </div>

                    <!-- لیست نظرات -->
                    <div class="comments-list">
                        {% for comment in post.comments.all %}
                            {% if not comment.parent %}
                                {% include 'comments/comment_item.html' with comment=comment level=0 %}
                            {% endif %}
                        {% empty %}
                            <div class="no-comments">
                                <p>هنوز نظری ثبت نشده است.</p>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- فرم ارسال نظر جدید -->
                    {% if user.is_authenticated %}
                        <div class="new-comment-form">
                            <h4>{{ user.username }} Leave a Reply </h4>
                            <form id="new-comment-form" method="POST" action="{% url 'add_comment' post.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="parent_id" value="">
                                <div class="form-group">
                                    <textarea name="body" class="form-control" rows="5" placeholder="نظر خود را اینجا بنویسید..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">ارسال نظر</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>

            {% block sidebar %}
                {% include "sidebar.html" %}
            {% endblock sidebar %}
        </div>
    </div>
</section>

<!-- آلرت‌ها -->
<div id="alert-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/comments.js' %}"></script>
{% endblock extra_js %}